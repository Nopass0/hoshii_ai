# Структура проекта

```
hoshii_ai/
├── src/                      # Исходный код приложения
│   ├── ai.ts                 # Модуль взаимодействия с AI API
│   │   ├── generateText      # Функция для генерации текстовых ответов
│   │   ├── generateStructured # Функция для генерации структурированных ответов
│   │   ├── RateLimiter       # Класс для управления квотами API
│   │   └── logger            # Простой логгер для отладки
│   ├── app.ts                # Основная логика приложения и игровой процесс
│   ├── types/                # Типы данных приложения
│   │   └── index.ts          # TypeScript интерфейсы (Item, NPC, Player, GameState, etc.)
│   ├── game/                 # Данные игрового мира
│   │   └── initialData.ts    # Начальные данные игрового мира, игрока, времени, погоды
│   └── utils.ts              # Утилитарные функции (например, бросок костей - будет добавлено)
├── node_modules/             # Зависимости проекта
├── project/                  # Документация проекта
│   ├── history.md            # История изменений
│   ├── structure.md          # Структура проекта
│   ├── tech.md               # Технологический стек
│   └── requests.md           # Архив запросов и ответов
└── package.json              # Конфигурация пакета и зависимости
```

## Описание основных компонентов

### src/ai.ts

Модуль отвечает за взаимодействие с AI API и обработку ответов. Основные компоненты:

#### RateLimiter
Управляет квотами API и предотвращает превышение лимитов запросов. Функциональность:
- Очередь запросов с приоритетами
- Управление скоростью запросов
- Повторные попытки при ошибках
- Обработка ситуаций превышения квот

#### logger
Простая система логирования с разными уровнями вывода:
- info: информационные сообщения
- error: сообщения об ошибках
- warn: предупреждения
- debug: отладочная информация

#### generateText
Функция для генерации текстовых ответов от AI модели:
- Поддержка истории сообщений
- Настройка системного промпта
- Поддержка инструментов (tools)
- Выбор языка ответа

#### generateStructured
Функция для генерации структурированных JSON-ответов:
- Валидация по схеме Zod
- Обработка ошибок парсинга
- Механизм повторных попыток
- Проверка корректности структуры ответа

### src/app.ts

Основной модуль приложения, реализующий логику игрового процесса и управление состоянием:

#### Основные компоненты:
- Функция `startDndGame` - главная функция игры, реализующая игровой цикл
- Функция `displayGameState` - отображение текущего состояния игры
- Функция `showInventory` - управление инвентарем игрока
- Функция `updateGameTime` - обновление игрового времени
- Функция `askQuestion` - взаимодействие с пользователем через консоль

#### Интерфейсы данных:
- `GameState` - структура игрового состояния
- `Player` - информация о игроке
- `Item` - предметы в игре
- `NPC` - неигровые персонажи
- `Weather` - погодные условия
- `GameTime` - время в игре
- `GameWorld` - описание игрового мира

#### Основные функции:
- Генерация игровых сценариев через AI
- Управление инвентарем и предметами
- Контроль здоровья игрока и состояния игры
- Управление игровым временем
- Обработка действий игрока и развитие сюжета

### src/types/index.ts

Определение основных типов данных приложения.

### src/game/initialData.ts

Начальные данные игрового мира, игрока, времени, погоды.

### src/utils.ts

Утилитарные функции, такие как бросок костей (будет добавлено).
